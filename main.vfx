-sin
require alpha.vfx
require obj.vfx
require scripts/timer.vfx
require scripts/tilemap.vfx

0 0 at
obj root 
obj stage  stage root push
obj ui  ui root push
include ui.vfx

\ - Main loop

: present display al_flip_display ;
: poll poll-keyboard poll-mouse ;
: think root { act reckon } ;
: graphics cls root { draw } present ;
: frame poll think graphics pause ;
: go init-ui >display begin frame <esc> pressed? until >vfx ;

\ - Tests

create buf 20 16 * cells allot 
: *map buf 20 stage *tilemap ; \ dup as act> 
50 50 at *map constant map

z" data/tbank_test.png" loadbmp constant b
0 0 at b tbank bmpwrite
map as :: act> 0.5e 0.5e 2f>p scrollx v+! ; execute

: *box stage *child dup as act> 0.1e f>p x +! draw> blue 33 66 rectf red 33 66 rect ;
100 100 at *box constant box

: *text stage *child dup as draw> white s" Hello" text ; 
160 120 at *text constant hello

midentity 2e 2e mscale
go 